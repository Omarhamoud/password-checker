<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Password Check — Sweenah</title>
<style>
  :root{--bg:#0f1724;--card:#0b1220;--accent:#6ee7b7;--muted:#94a3b8;--danger:#fb7185;--glass:rgba(255,255,255,0.03)}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,#071021 0%, #081827 100%);color:#e6eef8;margin:0;padding:28px;display:flex;align-items:flex-start;justify-content:center;min-height:100vh}
  .card{width:100%;max-width:760px;background:var(--card);border-radius:12px;padding:20px;box-shadow:0 6px 30px rgba(2,6,23,0.6);backdrop-filter:blur(4px)}
  h1{margin:0 0 8px;font-size:20px}
  p.lead{margin:0 0 18px;color:var(--muted)}
  label{display:block;margin-bottom:8px;color:var(--muted);font-size:13px}
  .row{display:flex;gap:12px;align-items:center}
  input[type="password"], input[type="text"]{flex:1;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit;font-size:15px}
  button{background:linear-gradient(90deg,var(--accent),#34d399);border:none;padding:10px 14px;border-radius:10px;color:#042018;font-weight:600;cursor:pointer}
  button:disabled{opacity:0.5;cursor:not-allowed}
  .meta{margin-top:14px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .chip{background:rgba(255,255,255,0.03);padding:8px 10px;border-radius:10px;font-size:13px;color:var(--muted)}
  .result{margin-top:18px;padding:14px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.012), transparent);border:1px solid rgba(255,255,255,0.02)}
  .status-ok{color:#a7f3d0}
  .status-bad{color:var(--danger)}
  .strength-bar{height:10px;background:rgba(255,255,255,0.06);border-radius:6px;overflow:hidden;margin-top:8px}
  .strength-fill{height:100%;width:0%;transition:width .25s ease}
  .suggestion{margin-top:12px;display:flex;gap:10px;align-items:center}
  .suggestion input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  .small{font-size:13px;color:var(--muted)}
  .feedback{margin-top:10px;color:var(--muted);font-size:13px}
  .label-strength {margin-top:8px;font-weight:600}
</style>
</head>
<body>
  <div class="card" role="main" aria-labelledby="title">
    <h1 id="title">Password Check — Sweenah</h1>
    <p class="lead">Enter a password to check if it’s breached and see its strength.</p>

    <!-- === Password Test Section === -->
    <section id="password-test">
      <label for="pw">Password</label>
      <div class="row">
        <input id="pw" type="password" placeholder="Type the password here..." aria-label="password" />
        <button id="checkBtn">Check</button>
      </div>

      <!-- Strength meter directly under the password input -->
      <div id="liveStrength" style="margin-top:10px;display:block">
        <div class="label-strength small">Live strength</div>
        <div class="strength-bar" aria-hidden="true">
          <div id="liveFill" class="strength-fill" style="background:linear-gradient(90deg,#f97316,#f59e0b,#84cc16)"></div>
        </div>
        <div id="liveLabel" class="small" style="margin-top:6px;color:var(--muted)"></div>
      </div>

      <div class="meta">
        <div class="chip">No passwords are stored</div>
        <div class="chip small">We use k-anonymity with HIBP — we never send the full password</div>
      </div>

      <div id="result" class="result" style="display:none">
        <div id="pwnedStatus" class="small"></div>
        <div id="pwnedDetails" style="margin-top:12px"></div>
        <div id="feedback" class="feedback"></div>
      </div>
    </section>

    <!-- === Password Suggestion Section === -->
    <section id="password-suggest" style="margin-top:22px;border-top:1px dashed rgba(255,255,255,0.04);padding-top:18px">
      <h2 style="margin:0 0 8px;font-size:16px">Suggest a Strong Password</h2>
      <p class="small" style="margin:0 0 12px;color:var(--muted)">Provide some personal hints (optional). We will use them only as a seed to craft a stronger suggestion.</p>

      <!-- User-data inputs placed directly above the Suggest button -->
      <div style="display:flex;gap:10px;align-items:center;margin-bottom:10px">
        <input id="ud_name" type="text" placeholder="Your name (e.g., Ahmad)" />
        <input id="ud_birth" type="text" placeholder="Birthdate (e.g., 2001-05-14 or 14May01)" />
      </div>

      <div style="display:flex;gap:10px;align-items:center">
        <select id="len" style="padding:10px;border-radius:8px;background:var(--glass);border:1px solid rgba(255,255,255,0.04)">
          <option value="12">12</option>
          <option value="16" selected>16</option>
          <option value="20">20</option>
        </select>
        <label style="display:flex;align-items:center;gap:6px"><input id="useSymbols" type="checkbox" checked /> Symbols</label>
        <button id="suggestBtn">Suggest password</button>
      </div>

      <div id="suggestResult" class="result" style="display:none;margin-top:12px">
        <div style="display:flex;gap:10px;align-items:center">
          <input id="suggestedPw" readonly style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" />
          <button id="copyBtn">Copy</button>
        </div>
        <div style="margin-top:8px">
          <div class="small">Suggestion score: <span id="suggestScore"></span></div>
          <div id="suggestFeedback" class="feedback"></div>
        </div>
      </div>
    </section>

    <p class="small" style="margin-top:14px">Note: do not paste highly sensitive passwords here unless testing locally.</p>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js"></script>

<script>
  // Elements
  const pwInput = document.getElementById('pw');
  const liveFill = document.getElementById('liveFill');
  const liveLabel = document.getElementById('liveLabel');
  const checkBtn = document.getElementById('checkBtn');
  const resultEl = document.getElementById('result');
  const pwnedStatus = document.getElementById('pwnedStatus');
  const pwnedDetails = document.getElementById('pwnedDetails');
  const feedbackEl = document.getElementById('feedback');

  // User data
  const udName = document.getElementById('ud_name');
  const udBirth = document.getElementById('ud_birth');

  // Suggest
  const lenSelect = document.getElementById('len');
  const useSymbols = document.getElementById('useSymbols');
  const suggestBtn = document.getElementById('suggestBtn');
  const suggestResult = document.getElementById('suggestResult');
  const suggestedPw = document.getElementById('suggestedPw');
  const suggestScore = document.getElementById('suggestScore');
  const suggestFeedback = document.getElementById('suggestFeedback');
  const copyBtn = document.getElementById('copyBtn');

  function updateLiveStrength(pw) {
    try {
      const res = zxcvbn(pw || '');
      const score = res.score || 0;
      const pct = Math.round((score / 4) * 100);
      liveFill.style.width = pct + '%';
      const labels = ['Very weak','Weak','Fair','Strong','Very strong'];
      liveLabel.textContent = labels[score] || '';
    } catch (e) {
      liveFill.style.width = '0%';
      liveLabel.textContent = '';
    }
  }

  pwInput.addEventListener('input', (e) => {
    updateLiveStrength(e.target.value);
    resultEl.style.display = 'none';
    pwnedStatus.textContent = '';
    pwnedDetails.textContent = '';
    feedbackEl.textContent = '';
  });

  async function doTest(password) {
    checkBtn.disabled = true;
    checkBtn.textContent = 'Checking...';
    try {
      const resp = await fetch('/.netlify/functions/check-password', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ action: 'test', password })
      });
      const data = await resp.json();
      resultEl.style.display = 'block';

      if (data.pwned) {
        pwnedStatus.innerHTML = '<strong class="status-bad">Warning: this password appears in breaches</strong>';
        pwnedDetails.innerHTML = `<div class="small">Approx. times seen: <strong>${data.pwned_count ?? 'N/A'}</strong></div>`;
      } else {
        const labels = ['Very weak','Weak','Fair','Strong','Very strong'];
        pwnedStatus.innerHTML = `<strong class="${data.strength_score >=3 ? 'status-ok':'status-bad'}">${labels[data.strength_score] || ''}</strong>`;
        pwnedDetails.innerHTML = '';
      }

      if (data.strength_feedback) {
        if (data.strength_feedback.warning) feedbackEl.textContent = data.strength_feedback.warning;
        else feedbackEl.textContent = (data.strength_feedback.suggestions || []).join(' - ');
      } else {
        feedbackEl.textContent = '';
      }

    } catch (err) {
      alert('Error: ' + err.message);
    } finally {
      checkBtn.disabled = false;
      checkBtn.textContent = 'Check';
    }
  }

  checkBtn.addEventListener('click', async () => {
    const pw = pwInput.value.trim();
    if (!pw) { alert('Enter a password'); return; }
    updateLiveStrength(pw);
    await doTest(pw);
  });

  // Suggestion from user-provided data (name + manual birthdate string)
  async function doSuggestFromUserData(name, birth, length, symbols) {
    suggestBtn.disabled = true;
    suggestBtn.textContent = 'Generating...';
    try {
      const seed = (name || '') + '|' + (birth || '');
      const resp = await fetch('/.netlify/functions/check-password', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ action: 'suggest', seed, length: parseInt(length,10), symbols: !!symbols })
      });
      const data = await resp.json();
      if (data.suggested_password) {
        suggestResult.style.display = 'block';
        suggestedPw.value = data.suggested_password;
        suggestScore.textContent = (data.suggested_password_score ?? 'N/A') + '/4';
        suggestFeedback.textContent = data.strength_feedback && data.strength_feedback.warning ? data.strength_feedback.warning : (data.strength_feedback && data.strength_feedback.suggestions ? (data.strength_feedback.suggestions||[]).join(' - ') : '');
      } else {
        alert('Could not generate a suggestion. Please adjust inputs.');
      }
    } catch (e) {
      alert('Error: ' + e.message);
    } finally {
      suggestBtn.disabled = false;
      suggestBtn.textContent = 'Suggest password';
    }
  }

  suggestBtn.addEventListener('click', async () => {
    const name = udName.value.trim();
    const birth = udBirth.value.trim();
    const length = lenSelect.value;
    const symbols = useSymbols.checked;
    if (!name && !birth) {
      alert('Enter your name and/or birthdate to seed the suggestion');
      return;
    }
    await doSuggestFromUserData(name, birth, length, symbols);
  });

  copyBtn.addEventListener('click', async () => {
    const val = suggestedPw.value;
    try {
      await navigator.clipboard.writeText(val);
      copyBtn.textContent = 'Copied';
      setTimeout(()=>copyBtn.textContent = 'Copy', 2000);
    } catch (e) {
      alert('Copy failed: ' + e.message);
    }
  });

  updateLiveStrength('');
</script>
</body>
</html>